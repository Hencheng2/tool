<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visual Page Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* ===== Global Dark Theme ===== */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header {
      background: #2a2a2a;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #444;
    }
    header h1 {
      font-size: 18px;
      margin: 0;
    }
    #main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ===== Sidebars ===== */
    .sidebar {
      width: 200px;
      background: #2a2a2a;
      border-right: 1px solid #444;
      padding: 10px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 14px;
      margin: 10px 0;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .element {
      padding: 8px;
      margin: 6px 0;
      background: #3a3a3a;
      border: 1px solid #555;
      border-radius: 6px;
      cursor: grab;
      text-align: center;
      user-select: none;
    }
    .element:hover {
      background: #555;
    }

    /* ===== Canvas ===== */
    .canvas-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #252525;
    }
    .toolbar {
      background: #2a2a2a;
      border-bottom: 1px solid #444;
      padding: 5px;
      display: flex;
      gap: 10px;
    }
    .toolbar button {
      padding: 5px 10px;
      background: #3a3a3a;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }
    .toolbar button:hover {
      background: #555;
    }
    #canvas {
      flex: 1;
      overflow: auto;
      position: relative;
      background: #1a1a1a;
      border: 2px dashed #444;
      transform-origin: top left;
    }
    #canvas .draggable {
      position: relative;
      padding: 10px;
      margin: 5px;
      border: 1px solid #666;
      background: #333;
      border-radius: 6px;
      cursor: move;
    }
    #canvas .draggable.container {
      min-height: 50px;
      padding: 15px;
      background: #3c3c3c;
    }
    #canvas .draggable.container .draggable {
      margin: 5px;
    }

    /* ===== Inspector ===== */
    .inspector {
      width: 250px;
      background: #2a2a2a;
      border-left: 1px solid #444;
      padding: 10px;
      overflow-y: auto;
    }
    .inspector h2 {
      font-size: 14px;
      margin: 10px 0;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .inspector label {
      font-size: 12px;
      display: block;
      margin: 5px 0 2px;
    }
    .inspector input,
    .inspector select {
      width: 100%;
      padding: 5px;
      border: none;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    /* ===== Code Output ===== */
    .code-section {
      height: 200px;
      display: flex;
      border-top: 1px solid #444;
    }
    .code-box {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #444;
    }
    .code-box:last-child {
      border-right: none;
    }
    .code-box header {
      background: #2a2a2a;
      padding: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #444;
    }
    .code-box header span {
      font-size: 12px;
    }
    .code-box textarea {
      flex: 1;
      background: #111;
      color: #0f0;
      border: none;
      resize: none;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
    }
    .copy-btn {
      padding: 2px 6px;
      font-size: 12px;
      border: none;
      background: #444;
      color: white;
      cursor: pointer;
      border-radius: 3px;
    }
    .copy-btn:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>Visual Page Builder</h1>
    <div>
      <button onclick="toggleViewMode()">Toggle View Mode</button>
      <button onclick="setDevice('desktop')">Desktop</button>
      <button onclick="setDevice('tablet')">Tablet</button>
      <button onclick="setDevice('phone')">Phone</button>
    </div>
  </header>

  <div id="main">
    <!-- Palette -->
    <aside class="sidebar">
      <h2>Elements</h2>
      <div class="element" draggable="true" data-type="navbar">Navbar</div>
      <div class="element" draggable="true" data-type="footer">Footer</div>
      <div class="element" draggable="true" data-type="text">Text</div>
      <div class="element" draggable="true" data-type="button">Button</div>
      <div class="element" draggable="true" data-type="image">Image</div>
      <div class="element" draggable="true" data-type="icon">Icon</div>
      <div class="element" draggable="true" data-type="card">Card</div>
      <div class="element" draggable="true" data-type="form">Form</div>
      <div class="element" draggable="true" data-type="grid">Grid</div>
      <div class="element" draggable="true" data-type="hero">Hero Section</div>
      <div class="element" draggable="true" data-type="sidebar">Sidebar</div>
      <div class="element" draggable="true" data-type="divider">Divider</div>
      <div class="element" draggable="true" data-type="video">Video</div>
      <div class="element" draggable="true" data-type="gallery">Gallery</div>
    </aside>

    <!-- Canvas -->
    <div class="canvas-container">
      <div class="toolbar">
        <button onclick="undo()">Undo</button>
        <button onclick="redo()">Redo</button>
        <button onclick="zoomIn()">Zoom +</button>
        <button onclick="zoomOut()">Zoom -</button>
      </div>
      <div id="canvas" ondragover="allowDrop(event)" ondrop="drop(event)">
        <!-- Dropped elements appear here -->
      </div>
    </div>

    <!-- Inspector -->
    <aside class="inspector">
      <h2>Inspector</h2>
      <div id="inspector-content">Select an element to edit</div>
    </aside>
  </div>

  <!-- Code Output -->
  <div class="code-section">
    <div class="code-box">
      <header>
        <span>HTML</span>
        <button class="copy-btn" onclick="copyCode('htmlCode')">Copy</button>
      </header>
      <textarea id="htmlCode" readonly></textarea>
    </div>
    <div class="code-box">
      <header>
        <span>CSS</span>
        <button class="copy-btn" onclick="copyCode('cssCode')">Copy</button>
      </header>
      <textarea id="cssCode" readonly></textarea>
    </div>
    <div class="code-box">
      <header>
        <span>JS</span>
        <button class="copy-btn" onclick="copyCode('jsCode')">Copy</button>
      </header>
      <textarea id="jsCode" readonly></textarea>
    </div>
  </div>

  <script>
    let canvas = document.getElementById("canvas");
    let inspector = document.getElementById("inspector-content");
    let selectedElement = null;
    let history = [];
    let historyIndex = -1;
    let zoomLevel = 1;
    let viewMode = false;

    // === Drag & Drop ===
    function allowDrop(ev) { 
      ev.preventDefault(); 
      ev.currentTarget.classList.add('drop-target');
    }
    function dragLeave(ev) {
      ev.currentTarget.classList.remove('drop-target');
    }
    document.querySelectorAll(".element").forEach(el => {
      el.addEventListener("dragstart", e => {
        e.dataTransfer.setData("type", e.target.dataset.type);
      });
    });
    function drop(ev) {
      ev.preventDefault();
      ev.currentTarget.classList.remove('drop-target');
      let type = ev.dataTransfer.getData("type");
      let target = ev.target.closest('.draggable');
      let newEl = createElement(type);
      
      // If dropping on a container element (navbar, grid, card, hero, sidebar), append inside
      if (target && target.classList.contains('container')) {
        target.appendChild(newEl);
      } else {
        canvas.appendChild(newEl);
      }
      
      saveHistory();
      updateCode();
    }

    function createElement(type) {
      let el = document.createElement("div");
      el.classList.add("draggable");
      el.setAttribute('data-type', type);
      el.onclick = (e) => { e.stopPropagation(); selectElement(el); };
      
      // Containers can accept nested elements
      if (['navbar', 'grid', 'card', 'hero', 'sidebar'].includes(type)) {
        el.classList.add('container');
        el.setAttribute('ondragover', 'allowDrop(event)');
        el.setAttribute('ondragleave', 'dragLeave(event)');
        el.setAttribute('ondrop', 'drop(event)');
      }

      switch(type) {
        case "navbar": 
          el.innerHTML = `<nav style="display:flex; gap:10px; padding:10px;">Navbar</nav>`;
          el.setAttribute('data-url', '');
          break;
        case "footer": 
          el.innerHTML = `<footer style="padding:10px;">Footer</footer>`;
          break;
        case "text": 
          el.innerHTML = `<p>Editable text</p>`;
          break;
        case "button": 
          el.innerHTML = `<button>Click Me</button>`;
          el.setAttribute('data-url', '');
          break;
        case "image": 
          el.innerHTML = `<img src="https://via.placeholder.com/150" alt="Image" style="max-width:100%;">`;
          break;
        case "icon": 
          el.innerHTML = `<span style="font-size:24px;">â˜…</span>`;
          el.setAttribute('data-url', '');
          break;
        case "card":
          el.innerHTML = `
            <div style="padding:10px; border:1px solid #666; border-radius:6px; background:#444;">
              <img src="https://via.placeholder.com/150" style="max-width:100%; border-radius:6px;">
              <h3>Card Title</h3>
              <p>Card description text.</p>
              <button data-url="">Read More</button>
            </div>`;
          break;
        case "form":
          el.innerHTML = `
            <form style="display:flex; flex-direction:column; gap:5px;">
              <input type="text" placeholder="Your name" style="width:100%; margin-bottom:5px;">
              <textarea placeholder="Your message" style="width:100%; margin-bottom:5px;"></textarea>
              <button type="submit">Submit</button>
            </form>`;
          break;
        case "grid":
          el.innerHTML = `
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <div style="background:#444; padding:10px;">Grid Item 1</div>
              <div style="background:#555; padding:10px;">Grid Item 2</div>
            </div>`;
          break;
        case "hero":
          el.innerHTML = `
            <section style="text-align:center; padding:20px; background:#3a3a3a;">
              <h1>Hero Title</h1>
              <p>Welcome to our website!</p>
              <button data-url="">Get Started</button>
            </section>`;
          break;
        case "sidebar":
          el.innerHTML = `
            <aside style="padding:10px; background:#3a3a3a; width:200px;">
              <h3>Sidebar</h3>
              <ul><li>Item 1</li><li>Item 2</li></ul>
            </aside>`;
          break;
        case "divider":
          el.innerHTML = `<hr style="border:1px solid #666;">`;
          break;
        case "video":
          el.innerHTML = `<video controls style="max-width:100%;"><source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4"></video>`;
          break;
        case "gallery":
          el.innerHTML = `
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(100px, 1fr)); gap:5px;">
              <img src="https://via.placeholder.com/100" alt="Gallery Image 1">
              <img src="https://via.placeholder.com/100" alt="Gallery Image 2">
            </div>`;
          break;
      }
      return el;
    }

    // === Inspector ===
    function selectElement(el) {
      selectedElement = el;
      let type = el.getAttribute('data-type');
      let inspectorHTML = `
        <label>Content</label>
        <input type="text" value="${el.innerText}" onchange="updateContent(this.value)">
        <label>Background</label>
        <input type="color" value="${el.style.background || '#333'}" onchange="updateBackground(this.value)">
        <label>Text Color</label>
        <input type="color" value="${el.style.color || '#f5f5f5'}" onchange="updateTextColor(this.value)">
        <label>Font Size (px)</label>
        <input type="number" value="${parseInt(el.style.fontSize) || 14}" onchange="updateFontSize(this.value)">
        <label>Padding (px)</label>
        <input type="number" value="${parseInt(el.style.padding) || 10}" onchange="updatePadding(this.value)">
        <label>Border Width (px)</label>
        <input type="number" value="${parseInt(el.style.borderWidth) || 1}" onchange="updateBorderWidth(this.value)">
        <label>Border Style</label>
        <select onchange="updateBorderStyle(this.value)">
          <option value="solid" ${el.style.borderStyle === 'solid' ? 'selected' : ''}>Solid</option>
          <option value="dashed" ${el.style.borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>
          <option value="dotted" ${el.style.borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>
          <option value="none" ${el.style.borderStyle === 'none' ? 'selected' : ''}>None</option>
        </select>
        <label>Border Color</label>
        <input type="color" value="${el.style.borderColor || '#666'}" onchange="updateBorderColor(this.value)">
        <label>Border Radius (px)</label>
        <input type="number" value="${parseInt(el.style.borderRadius) || 6}" onchange="updateBorderRadius(this.value)">
      `;
      
      // Add URL field for clickable elements
      if (['button', 'navbar', 'icon', 'hero', 'card'].includes(type)) {
        let url = el.getAttribute('data-url') || '';
        inspectorHTML += `
          <label>URL/Page Name</label>
          <input type="text" value="${url}" onchange="updateURL(this.value)">
        `;
      }
      
      inspector.innerHTML = inspectorHTML;
    }

    function updateContent(val) { 
      if (selectedElement) { 
        selectedElement.innerText = val; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateBackground(val) { 
      if (selectedElement) { 
        selectedElement.style.background = val; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateTextColor(val) { 
      if (selectedElement) { 
        selectedElement.style.color = val; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateFontSize(val) { 
      if (selectedElement) { 
        selectedElement.style.fontSize = val + "px"; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updatePadding(val) { 
      if (selectedElement) { 
        selectedElement.style.padding = val + "px"; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateBorderWidth(val) { 
      if (selectedElement) { 
        selectedElement.style.borderWidth = val + "px"; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateBorderStyle(val) { 
      if (selectedElement) { 
        selectedElement.style.borderStyle = val; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateBorderColor(val) { 
      if (selectedElement) { 
        selectedElement.style.borderColor = val; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateBorderRadius(val) { 
      if (selectedElement) { 
        selectedElement.style.borderRadius = val + "px"; 
        saveHistory(); 
        updateCode(); 
      } 
    }
    function updateURL(val) {
      if (selectedElement) {
        selectedElement.setAttribute('data-url', val);
        let anchor = selectedElement.querySelector('a') || document.createElement('a');
        anchor.href = val || '#';
        anchor.style.textDecoration = 'none';
        anchor.style.color = 'inherit';
        if (!selectedElement.querySelector('a')) {
          anchor.innerHTML = selectedElement.innerHTML;
          selectedElement.innerHTML = '';
          selectedElement.appendChild(anchor);
        }
        saveHistory();
        updateCode();
      }
    }

    // === Undo/Redo ===
    function saveHistory() {
      history = history.slice(0, historyIndex + 1);
      history.push(canvas.innerHTML);
      historyIndex++;
    }
    function undo() {
      if (historyIndex > 0) {
        historyIndex--;
        canvas.innerHTML = history[historyIndex];
        resetSelection();
        updateCode();
        // Reattach event listeners to restored elements
        canvas.querySelectorAll('.draggable').forEach(el => {
          el.onclick = (e) => { e.stopPropagation(); selectElement(el); };
          if (el.classList.contains('container')) {
            el.setAttribute('ondragover', 'allowDrop(event)');
            el.setAttribute('ondragleave', 'dragLeave(event)');
            el.setAttribute('ondrop', 'drop(event)');
          }
        });
      }
    }
    function redo() {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        canvas.innerHTML = history[historyIndex];
        resetSelection();
        updateCode();
        // Reattach event listeners to restored elements
        canvas.querySelectorAll('.draggable').forEach(el => {
          el.onclick = (e) => { e.stopPropagation(); selectElement(el); };
          if (el.classList.contains('container')) {
            el.setAttribute('ondragover', 'allowDrop(event)');
            el.setAttribute('ondragleave', 'dragLeave(event)');
            el.setAttribute('ondrop', 'drop(event)');
          }
        });
      }
    }
    function resetSelection() {
      selectedElement = null;
      inspector.innerHTML = "Select an element to edit";
    }

    // === Zoom ===
    function zoomIn() { 
      zoomLevel += 0.1; 
      canvas.style.transform = `scale(${zoomLevel})`; 
    }
    function zoomOut() { 
      zoomLevel = Math.max(0.5, zoomLevel - 0.1); 
      canvas.style.transform = `scale(${zoomLevel})`; 
    }

    // === Device Preview ===
    function setDevice(device) {
      canvas.style.width = device === "desktop" ? "100%" : device === "tablet" ? "768px" : "375px";
      canvas.style.margin = "0 auto";
    }

    // === View Mode ===
    function toggleViewMode() {
      viewMode = !viewMode;
      canvas.querySelectorAll(".draggable").forEach(el => {
        el.style.pointerEvents = viewMode ? "auto" : "all";
      });
      canvas.style.border = viewMode ? "none" : "2px dashed #444";
    }

    // === Code Generation ===
    function updateCode() {
      // Clean up HTML output
      let htmlOutput = canvas.innerHTML;
      // Remove editor-specific attributes
      htmlOutput = htmlOutput.replace(/ (ondragover|ondragleave|ondrop)="[^"]*"/g, '');
      htmlOutput = htmlOutput.replace(/ draggable="true"/g, '');
      htmlOutput = htmlOutput.replace(/ class="draggable( container)?"/g, '');
      htmlOutput = htmlOutput.replace(/ data-type="[^"]*"/g, '');
      
      // Convert data-url to href for clickable elements
      canvas.querySelectorAll('[data-url]').forEach(el => {
        let url = el.getAttribute('data-url');
        if (url) {
          let regex = new RegExp(`<(${el.tagName.toLowerCase()}[^>]*data-url="${url}"[^>]*)>`, 'g');
          htmlOutput = htmlOutput.replace(regex, `<${el.tagName.toLowerCase()} href="${url}" $1>`);
        }
      });
      
      document.getElementById("htmlCode").value = htmlOutput;
      
      // Generate CSS for all elements
      let cssOutput = '';
      canvas.querySelectorAll('.draggable').forEach((el, index) => {
        let styles = `
          .element-${index} {
            ${el.style.cssText ? el.style.cssText.replace(/;/g, ';\n            ') : ''}
          }
        `;
        cssOutput += styles;
        el.setAttribute('data-element-id', `element-${index}`);
      });
      
      document.getElementById("cssCode").value = cssOutput || "/* Custom styles will appear here */";
      document.getElementById("jsCode").value = "// Custom scripts will appear here";
    }

    function copyCode(id) {
      let ta = document.getElementById(id);
      ta.select();
      document.execCommand("copy");
    }

    // Init
    saveHistory();
  </script>
</body>
</html>
