<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Web Design Tool</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #1a1a1a;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header {
      padding: 1rem;
      background-color: #2d3748;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .sidebar, .properties-panel {
      width: 280px;
      background-color: #212121;
      padding: 1rem;
      overflow-y: auto;
      transition: width 0.3s ease;
    }
    .canvas-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 1rem;
      overflow-y: auto;
    }
    .page-canvas {
      background-color: #2d3748;
      border: 2px dashed #4a5568;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      transition: width 0.3s ease, height 0.3s ease, transform 0.3s ease;
      transform-origin: top center;
    }
    .element-item {
      padding: 0.75rem;
      background-color: #2d3748;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 0.5rem;
      transition: background-color 0.2s ease;
    }
    .element-item:hover {
      background-color: #4a90e2;
    }
    .tool-button {
      padding: 0.5rem 1rem;
      background-color: #4a5568;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .tool-button:hover {
      background-color: #636b77;
    }
    .tool-button.active {
      background-color: #4a90e2;
    }
    .element {
      position: absolute;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.2s ease;
    }
    .element.selected {
      border-color: #4a90e2;
    }
    .resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #4a90e2;
      border: 1px solid #1a1a1a;
      z-index: 100;
    }
    .handle-tl { top: -5px; left: -5px; cursor: nw-resize; }
    .handle-tr { top: -5px; right: -5px; cursor: ne-resize; }
    .handle-bl { bottom: -5px; left: -5px; cursor: sw-resize; }
    .handle-br { bottom: -5px; right: -5px; cursor: se-resize; }
    .code-output {
      padding: 1rem;
      background-color: #212121;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }
    textarea {
      width: 100%;
      height: 200px;
      background-color: #1a1a1a;
      color: #e0e0e0;
      border: 1px solid #4a5568;
      padding: 0.5rem;
      font-family: monospace;
      font-size: 0.8rem;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>

  <header>
    <div style="display: flex; align-items: center; gap: 1rem;">
      <h1 style="font-size: 1.5rem; font-weight: bold;">Web Design Tool</h1>
      <div id="mode-toggles" style="display: flex; gap: 0.5rem;">
        <button id="edit-mode-btn" class="tool-button active">Edit Mode</button>
        <button id="view-mode-btn" class="tool-button">View Mode</button>
      </div>
      <div id="screen-size-toggles" style="display: flex; gap: 0.5rem;">
        <button id="phone-btn" class="tool-button">Phone</button>
        <button id="tablet-btn" class="tool-button">Tablet</button>
        <button id="laptop-btn" class="tool-button active">Laptop</button>
      </div>
    </div>
    <div style="display: flex; gap: 0.5rem;">
      <button id="undo-btn" class="tool-button">Undo</button>
      <button id="redo-btn" class="tool-button">Redo</button>
      <button id="save-btn" class="tool-button">Save</button>
      <button id="load-btn" class="tool-button">Load</button>
    </div>
  </header>

  <div class="main-container">
    <aside id="element-panel" class="sidebar">
      <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Elements</h2>
      <div id="element-list">
        </div>
    </aside>

    <main class="canvas-container" id="canvas-container">
      <div id="page-canvas" class="page-canvas">
        </div>
    </main>

    <aside id="properties-panel" class="properties-panel hidden">
      <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Element Properties</h2>
      <div id="properties-editor">
        </div>
    </aside>
  </div>

  <footer id="code-area" class="code-output">
    <div>
      <h3 style="font-weight: bold;">HTML <button onclick="copyCode('html')" class="tool-button">Copy</button></h3>
      <textarea id="html-output" readonly></textarea>
    </div>
    <div>
      <h3 style="font-weight: bold;">CSS <button onclick="copyCode('css')" class="tool-button">Copy</button></h3>
      <textarea id="css-output" readonly></textarea>
    </div>
    <div>
      <h3 style="font-weight: bold;">JavaScript <button onclick="copyCode('js')" class="tool-button">Copy</button></h3>
      <textarea id="js-output" readonly></textarea>
    </div>
  </footer>

  <script>
    const state = {
      mode: 'edit',
      screenSize: 'laptop',
      elements: [],
      selectedElementId: null,
      history: [[]],
      historyIndex: 0
    };

    const elementsList = [
      { type: 'heading', label: 'Heading', defaultContent: 'New Heading', defaultStyles: { fontSize: '2rem', fontWeight: 'bold' } },
      { type: 'paragraph', label: 'Paragraph', defaultContent: 'Lorem ipsum dolor sit amet.', defaultStyles: { fontSize: '1rem' } },
      { type: 'button', label: 'Button', defaultContent: 'Click Me', defaultStyles: { backgroundColor: '#4a90e2', color: 'white', padding: '8px 16px', borderRadius: '4px', border: 'none' } },
      { type: 'image', label: 'Image', defaultContent: 'https://via.placeholder.com/150', defaultStyles: { width: '150px', height: '150px' } },
      { type: 'link', label: 'Link', defaultContent: 'Link', defaultStyles: { color: '#4a90e2' } },
    ];

    const screenSizes = {
      phone: { width: 375, height: 667 },
      tablet: { width: 768, height: 1024 },
      laptop: { width: 1366, height: 768 },
    };

    // DOM Elements
    const pageCanvas = document.getElementById('page-canvas');
    const elementPanel = document.getElementById('element-panel');
    const propertiesPanel = document.getElementById('properties-panel');
    const propertiesEditor = document.getElementById('properties-editor');
    const codeArea = document.getElementById('code-area');
    const htmlOutput = document.getElementById('html-output');
    const cssOutput = document.getElementById('css-output');
    const jsOutput = document.getElementById('js-output');
    const editModeBtn = document.getElementById('edit-mode-btn');
    const viewModeBtn = document.getElementById('view-mode-btn');
    const phoneBtn = document.getElementById('phone-btn');
    const tabletBtn = document.getElementById('tablet-btn');
    const laptopBtn = document.getElementById('laptop-btn');
    const undoBtn = document.getElementById('undo-btn');
    const redoBtn = document.getElementById('redo-btn');
    const saveBtn = document.getElementById('save-btn');
    const loadBtn = document.getElementById('load-btn');

    // --- Core Functions ---

    function saveState() {
      state.history = state.history.slice(0, state.historyIndex + 1);
      state.history.push(JSON.parse(JSON.stringify(state.elements)));
      state.historyIndex = state.history.length - 1;
    }

    function render() {
      // Clear canvas
      pageCanvas.innerHTML = '';
      pageCanvas.style.width = `${screenSizes[state.screenSize].width}px`;
      pageCanvas.style.height = `${screenSizes[state.screenSize].height}px`;
      
      const containerWidth = document.getElementById('canvas-container').offsetWidth;
      const scale = Math.min(1, containerWidth / (screenSizes[state.screenSize].width + 40));
      pageCanvas.style.transform = `scale(${scale})`;

      // Render elements
      state.elements.forEach(el => {
        const elementDiv = document.createElement('div');
        elementDiv.classList.add('element');
        if (state.mode === 'edit' && state.selectedElementId === el.id) {
          elementDiv.classList.add('selected');
        }

        elementDiv.dataset.id = el.id;
        elementDiv.style.position = 'absolute';
        elementDiv.style.left = `${el.x}px`;
        elementDiv.style.top = `${el.y}px`;
        elementDiv.style.width = `${el.width}px`;
        elementDiv.style.height = `${el.height}px`;

        const finalStyles = { ...el.styles, ...(el.responsive[state.screenSize] || {}) };
        Object.entries(finalStyles).forEach(([key, value]) => {
          elementDiv.style[key] = value;
        });

        // Add content based on type
        let contentEl;
        switch (el.type) {
          case 'heading':
            contentEl = document.createElement('h1');
            contentEl.textContent = el.content;
            break;
          case 'paragraph':
            contentEl = document.createElement('p');
            contentEl.textContent = el.content;
            break;
          case 'button':
            contentEl = document.createElement('button');
            contentEl.textContent = el.content;
            break;
          case 'image':
            contentEl = document.createElement('img');
            contentEl.src = el.content;
            contentEl.style.width = '100%';
            contentEl.style.height = '100%';
            break;
          case 'link':
            contentEl = document.createElement('a');
            contentEl.textContent = el.content;
            contentEl.href = '#';
            break;
          default:
            contentEl = document.createElement('div');
            contentEl.textContent = el.type;
            break;
        }

        elementDiv.appendChild(contentEl);
        pageCanvas.appendChild(elementDiv);

        if (state.mode === 'edit') {
          elementDiv.draggable = true;
          elementDiv.ondragstart = (e) => onDragStart(e, el.id);

          if (state.selectedElementId === el.id) {
            addResizeHandles(elementDiv, el.id);
          }
        }
      });
      
      updatePropertiesPanel();
      updateCodeOutput();
    }

    function addResizeHandles(element, id) {
      const handles = ['tl', 'tr', 'bl', 'br'];
      handles.forEach(handleType => {
        const handle = document.createElement('div');
        handle.classList.add('resize-handle', `handle-${handleType}`);
        handle.onmousedown = (e) => onResizeStart(e, id, handleType);
        element.appendChild(handle);
      });
    }

    function updatePropertiesPanel() {
      propertiesEditor.innerHTML = '';
      if (state.mode === 'edit' && state.selectedElementId) {
        propertiesPanel.classList.remove('hidden');
        const selectedEl = state.elements.find(el => el.id === state.selectedElementId);
        
        const contentLabel = document.createElement('label');
        contentLabel.textContent = 'Content';
        propertiesEditor.appendChild(contentLabel);
        
        const contentInput = document.createElement('textarea');
        contentInput.value = selectedEl.content;
        contentInput.oninput = (e) => {
          saveState();
          selectedEl.content = e.target.value;
          render();
        };
        propertiesEditor.appendChild(contentInput);
        
        const styleHeader = document.createElement('h3');
        styleHeader.textContent = 'Styles';
        propertiesEditor.appendChild(styleHeader);

        const styleKeys = ['width', 'height', 'backgroundColor', 'color', 'fontSize', 'padding', 'borderRadius', 'border'];
        styleKeys.forEach(key => {
          const styleValue = selectedEl.styles[key] || '';
          
          const label = document.createElement('label');
          label.textContent = key;
          propertiesEditor.appendChild(label);
          
          const input = document.createElement('input');
          input.type = (key.includes('color')) ? 'color' : 'text';
          input.value = styleValue;
          input.oninput = (e) => {
            saveState();
            selectedEl.styles[key] = e.target.value;
            render();
          };
          propertiesEditor.appendChild(input);
        });

      } else {
        propertiesPanel.classList.add('hidden');
      }
    }

    function updateCodeOutput() {
      if (state.mode === 'edit') {
        codeArea.style.display = 'grid';
        htmlOutput.value = generateHTML();
        cssOutput.value = generateCSS();
        jsOutput.value = generateJS();
      } else {
        codeArea.style.display = 'none';
      }
    }

    // --- Event Handlers ---

    document.getElementById('element-list').innerHTML = elementsList.map(el =>
      `<div class="element-item" data-type="${el.type}">${el.label}</div>`
    ).join('');

    elementPanel.addEventListener('click', (e) => {
      if (e.target.classList.contains('element-item')) {
        const type = e.target.dataset.type;
        const defaultEl = elementsList.find(el => el.type === type);
        const newElement = {
          id: `el${Date.now()}`,
          type,
          content: defaultEl.defaultContent,
          x: 50,
          y: 50,
          width: 150,
          height: 50,
          styles: { ...defaultEl.defaultStyles },
          responsive: { phone: {}, tablet: {}, laptop: {} }
        };
        saveState();
        state.elements.push(newElement);
        state.selectedElementId = newElement.id;
        render();
      }
    });

    pageCanvas.addEventListener('click', (e) => {
      let targetElement = e.target.closest('.element');
      if (targetElement) {
        const id = targetElement.dataset.id;
        state.selectedElementId = id;
      } else {
        state.selectedElementId = null;
      }
      render();
    });

    pageCanvas.addEventListener('dragover', (e) => e.preventDefault());
    pageCanvas.addEventListener('drop', (e) => {
      e.preventDefault();
      const id = e.dataTransfer.getData('id');
      const x = e.clientX - pageCanvas.getBoundingClientRect().left;
      const y = e.clientY - pageCanvas.getBoundingClientRect().top;
      const el = state.elements.find(e => e.id === id);
      if (el) {
        saveState();
        el.x = x - (e.offsetX);
        el.y = y - (e.offsetY);
        render();
      }
    });

    function onDragStart(e, id) {
      e.dataTransfer.setData('id', id);
    }

    function onResizeStart(e, id, handleType) {
      e.preventDefault();
      const el = state.elements.find(e => e.id === id);
      if (!el) return;

      const startX = e.clientX;
      const startY = e.clientY;
      const startWidth = el.width;
      const startHeight = el.height;
      const startXPos = el.x;
      const startYPos = el.y;

      const onMouseMove = (moveEvent) => {
        let dx = moveEvent.clientX - startX;
        let dy = moveEvent.clientY - startY;

        let newWidth = startWidth;
        let newHeight = startHeight;
        let newX = startXPos;
        let newY = startYPos;

        if (handleType.includes('r')) newWidth = startWidth + dx;
        if (handleType.includes('l')) { newWidth = startWidth - dx; newX = startXPos + dx; }
        if (handleType.includes('b')) newHeight = startHeight + dy;
        if (handleType.includes('t')) { newHeight = startHeight - dy; newY = startYPos + dy; }

        el.width = newWidth;
        el.height = newHeight;
        el.x = newX;
        el.y = newY;
        render();
      };

      const onMouseUp = () => {
        saveState();
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      };

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    }
    
    editModeBtn.addEventListener('click', () => { state.mode = 'edit'; render(); updateButtons(); });
    viewModeBtn.addEventListener('click', () => { state.mode = 'view'; render(); updateButtons(); });
    phoneBtn.addEventListener('click', () => { state.screenSize = 'phone'; render(); updateButtons(); });
    tabletBtn.addEventListener('click', () => { state.screenSize = 'tablet'; render(); updateButtons(); });
    laptopBtn.addEventListener('click', () => { state.screenSize = 'laptop'; render(); updateButtons(); });
    undoBtn.addEventListener('click', () => {
        if (state.historyIndex > 0) {
            state.historyIndex--;
            state.elements = JSON.parse(JSON.stringify(state.history[state.historyIndex]));
            render();
        }
    });
    redoBtn.addEventListener('click', () => {
        if (state.historyIndex < state.history.length - 1) {
            state.historyIndex++;
            state.elements = JSON.parse(JSON.stringify(state.history[state.historyIndex]));
            render();
        }
    });
    saveBtn.addEventListener('click', () => {
        localStorage.setItem('webDesignTool', JSON.stringify(state.elements));
        alert('Design saved!');
    });
    loadBtn.addEventListener('click', () => {
        const savedElements = localStorage.getItem('webDesignTool');
        if (savedElements) {
            state.elements = JSON.parse(savedElements);
            state.history = [JSON.parse(savedElements)];
            state.historyIndex = 0;
            render();
            alert('Design loaded!');
        }
    });

    function updateButtons() {
      editModeBtn.classList.toggle('active', state.mode === 'edit');
      viewModeBtn.classList.toggle('active', state.mode === 'view');
      phoneBtn.classList.toggle('active', state.screenSize === 'phone');
      tabletBtn.classList.toggle('active', state.screenSize === 'tablet');
      laptopBtn.classList.toggle('active', state.screenSize === 'laptop');
      
      const isEditMode = state.mode === 'edit';
      elementPanel.style.display = isEditMode ? 'block' : 'none';
      codeArea.style.display = isEditMode ? 'grid' : 'none';
      propertiesPanel.style.display = isEditMode ? 'block' : 'none';
    }

    // --- Code Generation Functions ---
    function generateHTML() {
      let html = '<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>My Generated Page</title>\n  <link rel="stylesheet" href="styles.css">\n</head>\n<body>\n';
      state.elements.forEach(el => {
        let tag = '';
        switch(el.type) {
          case 'heading': tag = 'h1'; break;
          case 'paragraph': tag = 'p'; break;
          case 'button': tag = 'button'; break;
          case 'image': tag = 'img'; break;
          case 'link': tag = 'a'; break;
          default: tag = 'div';
        }
        const attrs = el.type === 'image' ? `src="${el.content}"` : ``;
        const content = el.type !== 'image' ? el.content : '';
        html += `  <${tag} id="${el.id}" ${attrs}>${content}</${tag}>\n`;
      });
      html += '</body>\n</html>';
      return html;
    }
    
    function generateCSS() {
      let css = `body { background-color: #1a1a1a; color: #e0e0e0; font-family: sans-serif; }\n\n`;
      state.elements.forEach(el => {
        css += `#${el.id} {\n`;
        css += `  position: absolute;\n`;
        css += `  left: ${el.x}px;\n`;
        css += `  top: ${el.y}px;\n`;
        css += `  width: ${el.width}px;\n`;
        css += `  height: ${el.height}px;\n`;
        Object.entries(el.styles).forEach(([key, value]) => {
          css += `  ${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${value};\n`;
        });
        css += `}\n\n`;
      });
      return css;
    }

    function generateJS() {
      return `// No interactive scripts generated for this simple version.`;
    }

    function copyCode(type) {
      const textarea = document.getElementById(`${type}-output`);
      textarea.select();
      document.execCommand('copy');
      alert(`Copied ${type.toUpperCase()} code to clipboard!`);
    }

    // Initial render
    render();
    updateButtons();
  </script>

</body>
</html>
