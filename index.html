<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WebDesign Pro â€” Editor + Accurate Preview</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --dark-bg:#1e1e1e;--darker-bg:#161616;--sidebar-bg:#252526;--accent:#007acc;
  --text:#e0e0e0;--border:#444;--danger:#f44336;--success:#4CAF50;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,system-ui,Arial;}
body{background:var(--dark-bg);color:var(--text);height:100vh;overflow:hidden}
.app{display:flex;flex-direction:column;height:100vh}
.header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--darker-bg);border-bottom:1px solid var(--border)}
.logo{color:var(--accent);font-weight:700}
.view-toggle{display:flex;background:var(--sidebar-bg);border-radius:6px;overflow:hidden}
.view-toggle button{padding:6px 12px;background:none;border:0;color:var(--text);cursor:pointer}
.view-toggle button.active{background:var(--accent);color:#fff}
.main{display:flex;flex:1;overflow:hidden}
.sidebar{width:250px;background:var(--sidebar-bg);padding:14px;border-right:1px solid var(--border);overflow:auto}
.category-title{color:var(--accent);margin-bottom:8px;font-weight:600}
.elements-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.element-item{background:var(--dark-bg);border:1px solid var(--border);padding:8px;border-radius:6px;text-align:center;cursor:grab}
.element-item:hover{background:#2b2b2b}
.work-area-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden}
.toolbar{display:flex;gap:8px;padding:10px;background:var(--darker-bg);border-bottom:1px solid var(--border);align-items:center}
.toolbar .btn{background:var(--sidebar-bg);border:1px solid var(--border);padding:6px 10px;border-radius:6px;cursor:pointer}
.toolbar .btn.danger{background:var(--danger);color:#fff;margin-left:auto}
.workspace{flex:1;display:flex;overflow:hidden;background:
  linear-gradient(45deg,#252526 25%,transparent 25%),
  linear-gradient(-45deg,#252526 25%,transparent 25%),
  linear-gradient(45deg,transparent 75%,#252526 75%),
  linear-gradient(-45deg,transparent 75%,#252526 75%);
background-size:20px 20px;padding:20px;justify-content:center;align-items:flex-start}
#design-area{width:100%;height:800px;background:#fff;box-shadow:0 8px 20px rgba(0,0,0,.5);position:relative;overflow:visible}
.code-panel{width:520px;background:var(--darker-bg);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.code-tabs{display:flex;background:var(--sidebar-bg);border-bottom:1px solid var(--border)}
.code-tab{padding:10px 16px;cursor:pointer}
.code-tab.active{background:var(--accent);color:#fff}
.code-container{flex:1;position:relative}
.editor{width:100%;height:100%}
.copy-button{position:absolute;top:8px;right:8px;background:var(--success);color:#fff;border:0;padding:6px 8px;border-radius:6px;cursor:pointer}
.property-group{margin-top:12px}
.property-input{width:100%;padding:8px;background:var(--dark-bg);border:1px solid var(--border);border-radius:6px;color:var(--text)}

/* Elements */
.element{position:absolute;cursor:move;border:2px dashed transparent;user-select:none;min-width:40px;min-height:30px}
.element.selected{border-color:var(--accent)}
.element .element-content{width:100%;height:100%;overflow:auto}
.resize-handle{position:absolute;width:10px;height:10px;background:var(--accent);z-index:10}
.nw{top:-5px;left:-5px;cursor:nw-resize}.ne{top:-5px;right:-5px;cursor:ne-resize}
.sw{bottom:-5px;left:-5px;cursor:sw-resize}.se{bottom:-5px;right:-5px;cursor:se-resize}

/* Visual preview mode hides the editor UI and replaces design area with iframe */
.preview-mode .sidebar,
.preview-mode .code-panel,
.preview-mode .toolbar{display:none}
.preview-mode .workspace{padding:0}
.preview-mode #design-area{box-shadow:none;}

/* helpful small styles for generated elements */
.navbar{width:100%;background:#333;color:#fff;padding:10px;display:flex;justify-content:space-between}
.button{padding:10px 16px;background:var(--accent);color:#fff;border-radius:6px;border:0;cursor:pointer}
.image-placeholder{background:#eee;border:2px dashed #999;display:flex;align-items:center;justify-content:center;color:#777}
.card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5)}
.modal-box{background:#fff;padding:18px;border-radius:8px;max-width:90%;max-height:90%;overflow:auto}
.scroll-container{background:#f7f7f7;border:1px solid #ddd;padding:10px;overflow:auto}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="logo">WebDesign Pro</div>
    <div class="view-toggle">
      <button id="design-view-btn" class="active">Design View</button>
      <button id="preview-view-btn">Preview View</button>
    </div>
  </header>

  <div class="main">
    <aside class="sidebar">
      <div class="category-title">Basic Elements</div>
      <div class="elements-list">
        <div class="element-item" draggable="true" data-type="button">Button</div>
        <div class="element-item" draggable="true" data-type="text">Text</div>
        <div class="element-item" draggable="true" data-type="image">Image</div>
        <div class="element-item" draggable="true" data-type="div">Container</div>
        <div class="element-item" draggable="true" data-type="scroll-container">Scrollable Container</div>
      </div>

      <div style="height:12px"></div>
      <div class="category-title">Navigation / UI</div>
      <div class="elements-list">
        <div class="element-item" draggable="true" data-type="navbar">Navbar</div>
        <div class="element-item" draggable="true" data-type="menu">Menu</div>
      </div>

      <div style="height:12px"></div>
      <div class="category-title">Content</div>
      <div class="elements-list">
        <div class="element-item" draggable="true" data-type="card">Card</div>
        <div class="element-item" draggable="true" data-type="modal">Modal</div>
        <div class="element-item" draggable="true" data-type="form">Form</div>
        <div class="element-item" draggable="true" data-type="video">Video</div>
      </div>

      <div class="property-group">
        <div class="category-title">Properties</div>
        <label>Background</label>
        <input id="prop-bg-color" type="color" class="property-input" value="#ffffff">
        <label style="margin-top:8px">Width</label>
        <input id="prop-width" class="property-input" placeholder="e.g., 200px or 50%">
        <label style="margin-top:8px">Height</label>
        <input id="prop-height" class="property-input" placeholder="e.g., 150px">
        <label style="margin-top:8px">Text</label>
        <textarea id="prop-text-content" class="property-input" rows="3"></textarea>
        <label style="margin-top:8px">Image URL</label>
        <input id="prop-image-url" class="property-input" placeholder="https://...jpg">
        <label style="margin-top:8px">Video URL</label>
        <input id="prop-video-url" class="property-input" placeholder="https://...mp4">
      </div>
    </aside>

    <div class="work-area-wrap">
      <div class="toolbar">
        <button id="export-html" class="btn">Export HTML</button>
        <button id="import-html" class="btn">Import HTML</button>
        <button id="clear-all" class="btn">Clear All</button>
        <button id="delete-element" class="btn danger">Delete Selected</button>
      </div>

      <div class="workspace">
        <div id="design-area"></div>
      </div>
    </div>

    <div class="code-panel">
      <div class="code-tabs">
        <div class="code-tab active" data-tab="html">HTML</div>
        <div class="code-tab" data-tab="css">CSS</div>
        <div class="code-tab" data-tab="js">JS</div>
      </div>
      <div class="code-container">
        <div id="html-editor" class="editor"></div>
        <div id="css-editor" class="editor" style="display:none"></div>
        <div id="js-editor" class="editor" style="display:none"></div>
        <button id="copy-html" class="copy-button">Copy HTML</button>
      </div>
    </div>
  </div>
</div>

<script>
let selectedElement = null;
let htmlEditor, cssEditor, jsEditor;
let designSnapshot = null;

// init editors + app
document.addEventListener('DOMContentLoaded', () => {
  initMonaco();
  setupDragFromSidebar();
  setupToolbar();
  setupViewToggle();
  bindGlobalShortcuts();
  // initial sample element
  createNewElement('navbar', 0, 0, true);
  createNewElement('card', 100, 120);
  generateCode();
});

function initMonaco(){
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
  require(['vs/editor/editor.main'], function() {
    htmlEditor = monaco.editor.create(document.getElementById('html-editor'), {value:'',language:'html',theme:'vs-dark',automaticLayout:true});
    cssEditor = monaco.editor.create(document.getElementById('css-editor'), {value:'',language:'css',theme:'vs-dark',automaticLayout:true});
    jsEditor = monaco.editor.create(document.getElementById('js-editor'), {value:'',language:'javascript',theme:'vs-dark',automaticLayout:true});
  });
  document.querySelectorAll('.code-tab').forEach(t=>{
    t.addEventListener('click',()=>{
      document.querySelectorAll('.code-tab').forEach(x=>x.classList.remove('active'));
      document.querySelectorAll('.editor').forEach(e=>e.style.display='none');
      t.classList.add('active');
      document.getElementById(t.dataset.tab+'-editor').style.display='block';
    });
  });
}

// sidebar drag
function setupDragFromSidebar(){
  document.querySelectorAll('.element-item').forEach(item=>{
    item.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', item.dataset.type));
  });
  const design = document.getElementById('design-area');
  design.addEventListener('dragover', e=>e.preventDefault());
  design.addEventListener('drop', e=>{
    e.preventDefault();
    const type = e.dataTransfer.getData('text/plain');
    const rect = design.getBoundingClientRect();
    createNewElement(type, e.clientX - rect.left, e.clientY - rect.top);
  });
}

// create element factory
function createNewElement(type, x=50, y=50, fullWidth=false){
  const design = document.getElementById('design-area');
  const el = document.createElement('div');
  el.className = 'element';
  el.dataset.type = type;
  // default position
  el.style.left = (x||50) + 'px';
  el.style.top = (y||50) + 'px';

  // content by type
  switch(type){
    case 'button':
      el.innerHTML = `<div class="element-content"><button class="button">Click Me</button></div>`; el.style.width='120px'; el.style.height='44px'; break;
    case 'navbar':
      el.innerHTML = `<div class="element-content"><div class="navbar"><div>Logo</div><div><a href="#home" style="color:#fff">Home</a></div></div></div>`; el.style.left='0'; el.style.top='0'; el.style.width='100%'; el.style.height='56px'; break;
    case 'image':
      el.innerHTML = `<div class="element-content"><div class="image-placeholder"><i class="fas fa-image"></i> Image</div></div>`; el.style.width='220px'; el.style.height='150px'; break;
    case 'card':
      el.innerHTML = `<div class="element-content"><div class="card"><h3>Card Title</h3><p>Card description...</p><button class="button">Learn More</button></div></div>`; el.style.width='260px'; el.style.height='170px'; break;
    case 'modal':
      // for design show modal box, in preview it becomes a trigger + overlay
      el.innerHTML = `<div class="element-content"><div class="modal"><h3>Modal Title</h3><p>Modal content...</p></div></div>`; el.style.width='380px'; el.style.height='160px'; break;
    case 'form':
      el.innerHTML = `<div class="element-content"><div class="form-element"><input placeholder="Name" style="width:100%;margin-bottom:8px;padding:6px"/><button class="button">Submit</button></div></div>`; el.style.width='320px'; el.style.height='160px'; break;
    case 'video':
      el.innerHTML = `<div class="element-content"><div class="video-container"><i class="fas fa-video"></i> Video</div></div>`; el.style.width='320px'; el.style.height='200px'; break;
    case 'div':
      el.innerHTML = `<div class="element-content"><div style="padding:8px">Container</div></div>`; el.style.width='180px'; el.style.height='120px'; break;
    case 'menu':
      el.innerHTML = `<div class="element-content"><div style="background:#333;color:#fff;padding:8px"><div>Home</div><div>Profile</div><div>Settings</div></div></div>`; el.style.width='160px'; el.style.height='160px'; break;
    case 'scroll-container':
      el.innerHTML = `<div class="element-content"><div class="scroll-container" style="height:100%;"><div style="height:800px">Scrollable inner content (tall). Add blocks inside for scroll.</div></div></div>`; el.style.width='360px'; el.style.height='220px'; break;
    default:
      el.innerHTML = `<div class="element-content">${type}</div>`; el.style.width='120px'; el.style.height='80px';
  }

  addResizeHandles(el);
  el.addEventListener('mousedown', startElementDrag);
  el.addEventListener('click', (e)=>{ e.stopPropagation(); selectElement(el); });
  design.appendChild(el);
  selectElement(el);
  generateCode();
}

// selection
function selectElement(el){
  document.querySelectorAll('.element').forEach(x=>x.classList.remove('selected'));
  selectedElement = el;
  if(el) el.classList.add('selected');
  updatePropertiesPanel();
}

// dragging
let dragOffset = {x:0,y:0};
function startElementDrag(e){
  if (document.body.classList.contains('preview-mode')) return;
  if(e.button!==0) return;
  const el = e.currentTarget.closest('.element');
  selectElement(el);
  const rect = el.getBoundingClientRect();
  const designRect = document.getElementById('design-area').getBoundingClientRect();
  dragOffset.x = e.clientX - rect.left;
  dragOffset.y = e.clientY - rect.top;
  function onMove(ev){
    let nx = ev.clientX - designRect.left - dragOffset.x;
    let ny = ev.clientY - designRect.top - dragOffset.y;
    nx = Math.max(0, nx); ny = Math.max(0, ny);
    nx = Math.min(designRect.width - el.offsetWidth, nx);
    ny = Math.min(designRect.height - el.offsetHeight, ny);
    el.style.left = nx + 'px'; el.style.top = ny + 'px';
  }
  function onUp(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); generateCode(); }
  document.addEventListener('mousemove', onMove);
  document.addEventListener('mouseup', onUp);
  e.preventDefault();
}

// resize handles
function addResizeHandles(el){
  ['nw','ne','sw','se'].forEach(pos=>{
    const h = document.createElement('div'); h.className = 'resize-handle ' + pos;
    h.addEventListener('mousedown', (e)=>startResize(e,pos)); el.appendChild(h);
  });
}
function startResize(e,dir){
  e.stopPropagation();
  if (document.body.classList.contains('preview-mode')) return;
  const el = e.currentTarget.parentElement;
  const start = {x:e.clientX,y:e.clientY,w:el.offsetWidth,h:el.offsetHeight,left:parseInt(el.style.left||0),top:parseInt(el.style.top||0)};
  function onMove(ev){
    const dx = ev.clientX - start.x, dy = ev.clientY - start.y;
    if(dir==='nw'){ el.style.width = Math.max(40, start.w - dx) + 'px'; el.style.height = Math.max(30, start.h - dy) + 'px'; el.style.left = start.left + dx + 'px'; el.style.top = start.top + dy + 'px'; }
    if(dir==='ne'){ el.style.width = Math.max(40, start.w + dx) + 'px'; el.style.height = Math.max(30, start.h - dy) + 'px'; el.style.top = start.top + dy + 'px'; }
    if(dir==='sw'){ el.style.width = Math.max(40, start.w - dx) + 'px'; el.style.height = Math.max(30, start.h + dy) + 'px'; el.style.left = start.left + dx + 'px'; }
    if(dir==='se'){ el.style.width = Math.max(40, start.w + dx) + 'px'; el.style.height = Math.max(30, start.h + dy) + 'px'; }
  }
  function onUp(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); generateCode(); }
  document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp);
}

// properties panel
function updatePropertiesPanel(){
  if(!selectedElement) return;
  const style = window.getComputedStyle(selectedElement);
  document.getElementById('prop-bg-color').value = rgbToHex(style.backgroundColor) || '#ffffff';
  document.getElementById('prop-width').value = selectedElement.style.width || style.width;
  document.getElementById('prop-height').value = selectedElement.style.height || style.height;
  const firstText = selectedElement.querySelector('button, p, h1, h2, span, div');
  document.getElementById('prop-text-content').value = firstText? firstText.textContent.trim() : '';
  const img = selectedElement.querySelector('img');
  document.getElementById('prop-image-url').value = img? img.src : '';
  const vid = selectedElement.querySelector('video source, video');
  document.getElementById('prop-video-url').value = vid? (vid.src || vid.getAttribute('src')) : '';
}

// apply prop changes
['prop-bg-color','prop-width','prop-height','prop-text-content','prop-image-url','prop-video-url'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>{
    if(!selectedElement) return;
    const v = document.getElementById(id).value;
    if(id==='prop-bg-color') selectedElement.style.backgroundColor = v;
    if(id==='prop-width') selectedElement.style.width = v;
    if(id==='prop-height') selectedElement.style.height = v;
    if(id==='prop-text-content'){
      const t = selectedElement.querySelector('button, p, h1, h2, span, div');
      if(t) t.textContent = v;
    }
    if(id==='prop-image-url'){
      const ph = selectedElement.querySelector('.image-placeholder');
      if(ph) ph.innerHTML = `<img src="${v}" style="width:100%;height:100%;object-fit:cover">`;
    }
    if(id==='prop-video-url'){
      const vc = selectedElement.querySelector('.video-container');
      if(vc) vc.innerHTML = `<video controls style="width:100%;height:100%"><source src="${v}" type="video/mp4">Your browser does not support video.</video>`;
    }
    generateCode();
  });
});

// toolbar
function setupToolbar(){
  document.getElementById('clear-all').addEventListener('click', ()=>{
    document.getElementById('design-area').innerHTML=''; selectedElement=null; generateCode();
  });
  document.getElementById('delete-element').addEventListener('click', ()=>{
    if(selectedElement){ selectedElement.remove(); selectedElement=null; generateCode(); }
  });
  document.getElementById('export-html').addEventListener('click', ()=>{ prompt('Copy HTML below:', generatePageHTML()); });
  document.getElementById('import-html').addEventListener('click', ()=>{
    const html = prompt('Paste HTML (full page) to import:');
    if(!html) return;
    // simple import: put into design area as raw preview iframe
    document.getElementById('design-area').innerHTML = '<iframe sandbox="allow-scripts allow-same-origin" style="width:100%;height:100%;border:0" srcdoc="'+escapeHtml(html)+'"></iframe>';
    document.body.classList.add('preview-mode');
  });
}

// view toggle
function setupViewToggle(){
  document.getElementById('design-view-btn').addEventListener('click', ()=>{ exitPreview(); });
  document.getElementById('preview-view-btn').addEventListener('click', ()=>{ enterPreview(); });
}

// generate code and populate editors
function generateCode(){
  const html = generatePageHTML();
  const css = generateInlineCSS();
  const js = generateInlineJS();
  if(htmlEditor) htmlEditor.setValue(html);
  if(cssEditor) cssEditor.setValue(css);
  if(jsEditor) jsEditor.setValue(js);
  // if in preview mode refresh iframe
  if(document.body.classList.contains('preview-mode')){
    setPreviewIframe(html + '\n<style>\n' + css + '\n</style>\n<script>\n' + js + '\n<\/script>');
  }
}

function generatePageHTML(){
  const design = document.getElementById('design-area');
  const elems = design.querySelectorAll('.element');
  // container width/height (represent viewport)
  const w = design.clientWidth, h = design.clientHeight;
  let body = `<div id="page-root" style="position:relative;width:${w}px;height:${h}px;">\n`;
  elems.forEach((el, i)=>{
    const type = el.dataset.type || 'div';
    const content = el.querySelector('.element-content').innerHTML;
    // inline styles for position & size & visual bg
    const left = el.style.left || window.getComputedStyle(el).left;
    const top = el.style.top || window.getComputedStyle(el).top;
    const width = el.style.width || window.getComputedStyle(el).width;
    const height = el.style.height || window.getComputedStyle(el).height;
    const bg = el.style.backgroundColor ? `background:${el.style.backgroundColor};` : '';
    const borderRadius = el.style.borderRadius ? `border-radius:${el.style.borderRadius};` : '';
    if(type==='modal'){
      // For modal create a trigger + hidden overlay (so clicking trigger opens the modal)
      const triggerId = `modal-trigger-${i}`, modalId = `modal-box-${i}`;
      body += `<div id="${triggerId}" style="position:absolute;left:${left};top:${top};width:${width};height:${height};${bg}${borderRadius}"><button class="button">Open Modal</button></div>\n`;
      body += `<div id="${modalId}" class="modal-overlay" style="display:none"><div class="modal-box">${content}<div style="text-align:right;margin-top:12px"><button class="button" data-close>Close</button></div></div></div>\n`;
    } else {
      body += `<div id="el-${i}" style="position:absolute;left:${left};top:${top};width:${width};height:${height};${bg}${borderRadius}">${content}</div>\n`;
    }
  });
  body += `</div>`;
  return '<!doctype html>\n<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body>'+body+'</body></html>';
}

function generateInlineCSS(){
  // minimal CSS to ensure layout & internal scrolling is local (no outer scrollbars)
  return `html,body{margin:0;height:100%;overflow:hidden}#page-root{box-sizing:border-box}
.modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:999}
.modal-box{background:#fff;padding:18px;border-radius:8px;max-width:800px;max-height:90%;overflow:auto}
.scroll-container{overflow:auto}`;
}

function generateInlineJS(){
  // make triggers work, close buttons, allow links to open, videos playable
  return `document.addEventListener('click',function(e){
    if(e.target.matches('[data-close]')){ e.target.closest('.modal-overlay').style.display='none'; }
    // open modal triggers
    if(e.target.closest('[id^="modal-trigger-"]')){ const id = e.target.closest('[id^="modal-trigger-"]').id; const idx = id.split('-').pop(); const modal = document.getElementById('modal-box-'+idx); if(modal) modal.style.display='flex'; }
  },false);`;
}

// preview lifecycle
function enterPreview(){
  // snapshot design HTML for restore
  designSnapshot = document.getElementById('design-area').innerHTML;
  document.body.classList.add('preview-mode');
  // build full page (includes CSS & JS)
  const full = generatePageHTML();
  const css = generateInlineCSS();
  const js = generateInlineJS();
  setPreviewIframe(full + '\n<style>\n' + css + '\n</style>\n<script>\n' + js + '\n<\/script>');
  document.getElementById('preview-view-btn').classList.add('active');
  document.getElementById('design-view-btn').classList.remove('active');
}

function setPreviewIframe(srcdoc){
  const area = document.getElementById('design-area');
  area.innerHTML = '';
  const iframe = document.createElement('iframe');
  iframe.setAttribute('sandbox','allow-scripts allow-same-origin allow-forms');
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '0';
  iframe.style.display = 'block';
  iframe.srcdoc = srcdoc;
  // prevent outer scrollbars by making iframe itself the viewport
  area.appendChild(iframe);
}

function exitPreview(){
  if(!document.body.classList.contains('preview-mode')) return;
  document.body.classList.remove('preview-mode');
  if(designSnapshot!==null){
    const area = document.getElementById('design-area');
    area.innerHTML = designSnapshot;
    // re-bind events for elements created via innerHTML
    rebindAllElements();
  }
  document.getElementById('design-view-btn').classList.add('active');
  document.getElementById('preview-view-btn').classList.remove('active');
  generateCode();
}

// after restoring design-area from snapshot, reattach handlers
function rebindAllElements(){
  document.querySelectorAll('.element').forEach(el=>{
    el.addEventListener('mousedown', startElementDrag);
    el.addEventListener('click', (e)=>{ e.stopPropagation(); selectElement(el); });
    // ensure resize handles trigger resize: re-add handles if absent
    if(!el.querySelector('.resize-handle')) addResizeHandles(el);
  });
}

// helpers & utilities
function generateRawElementsArray(){ return Array.from(document.querySelectorAll('#design-area .element')); }
function rgbToHex(rgb){
  if(!rgb) return '#ffffff';
  const m = rgb.match(/\d+/g); if(!m) return '#ffffff';
  return '#'+(+m[0]).toString(16).padStart(2,'0')+(+m[1]).toString(16).padStart(2,'0')+(+m[2]).toString(16).padStart(2,'0');
}
function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// short keys
function bindGlobalShortcuts(){
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Delete' && selectedElement){ selectedElement.remove(); selectedElement=null; generateCode(); }
    if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); alert('Code copied to clipboard'); navigator.clipboard.writeText(htmlEditor.getValue()); }
  });
}

// when click outside elements, deselect
document.getElementById('design-area').addEventListener('click', ()=>{ document.querySelectorAll('.element').forEach(x=>x.classList.remove('selected')); selectedElement=null; });

// copy HTML button
document.getElementById('copy-html').addEventListener('click', ()=>{
  navigator.clipboard.writeText(htmlEditor.getValue()).then(()=>{ alert('HTML copied'); });
});
</script>
</body>
</html>
