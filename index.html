<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Page Designer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .designer-container {
            height: calc(100vh - 4rem);
            max-height: calc(100vh - 4rem);
        }
        .code-editor {
            resize: none;
            scrollbar-width: thin;
        }
        .code-editor::-webkit-scrollbar {
            width: 8px;
        }
        .code-editor::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .code-editor::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 4px;
        }
        .draggable {
            cursor: grab;
        }
        .draggable:active {
            cursor: grabbing;
        }
        .selected-element {
            outline: 2px dashed #34d399; /* emerald-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-4 overflow-hidden">

    <!-- Header -->
    <header class="flex justify-between items-center py-2 px-4 mb-4">
        <h1 class="text-2xl font-bold text-emerald-400">Web Designer</h1>
        <div class="space-x-2">
            <button id="editViewBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">Edit</button>
            <button id="viewPreviewBtn" class="bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-2 px-4 rounded-lg transition-colors">Preview</button>
        </div>
    </header>

    <!-- Main Designer Container -->
    <main id="designer-main-view" class="flex flex-col lg:flex-row gap-4 designer-container transition-all duration-300">

        <!-- Elements Library and Properties Panel -->
        <aside class="bg-gray-800 p-4 rounded-xl shadow-lg flex-none w-full lg:w-1/4 max-w-sm overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 text-emerald-400">Elements Library</h2>
            <div id="elements-library" class="grid grid-cols-2 gap-4">
                <div class="draggable p-4 bg-gray-700 rounded-lg text-center hover:bg-gray-600 transition-colors cursor-grab" draggable="true" data-type="button">
                    <span class="text-3xl">üéöÔ∏è</span>
                    <p class="mt-2 text-sm font-medium">Button</p>
                </div>
                <div class="draggable p-4 bg-gray-700 rounded-lg text-center hover:bg-gray-600 transition-colors cursor-grab" draggable="true" data-type="h1">
                    <span class="text-3xl">üìù</span>
                    <p class="mt-2 text-sm font-medium">Heading</p>
                </div>
                <div class="draggable p-4 bg-gray-700 rounded-lg text-center hover:bg-gray-600 transition-colors cursor-grab" draggable="true" data-type="p">
                    <span class="text-3xl">üìÑ</span>
                    <p class="mt-2 text-sm font-medium">Paragraph</p>
                </div>
                <div class="draggable p-4 bg-gray-700 rounded-lg text-center hover:bg-gray-600 transition-colors cursor-grab" draggable="true" data-type="div">
                    <span class="text-3xl">üß±</span>
                    <p class="mt-2 text-sm font-medium">Container</p>
                </div>
                <!-- Add more elements here if needed -->
            </div>

            <div id="properties-panel" class="mt-6 p-4 bg-gray-700 rounded-lg hidden">
                <h3 class="text-lg font-semibold mb-3">Element Properties</h3>
                <div id="properties-editor" class="space-y-4">
                    <!-- Property inputs will be dynamically generated here -->
                </div>
            </div>
        </aside>

        <!-- Canvas and Code Editors -->
        <section class="flex flex-col flex-grow w-full lg:w-3/4">

            <!-- Designer Canvas -->
            <div id="designer-canvas" class="flex-grow bg-gray-800 rounded-xl shadow-lg overflow-y-auto p-6 border-4 border-dashed border-gray-700 mb-4 transition-all" dropzone="true">
                <p class="text-center text-gray-500 font-medium">Drag and drop elements here</p>
            </div>

            <!-- Code Editors -->
            <div id="code-editors-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 h-56 flex-none">

                <!-- HTML Editor -->
                <div class="bg-gray-800 rounded-xl p-4 flex flex-col shadow-lg">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-sm text-yellow-400">HTML</h3>
                        <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs py-1 px-3 rounded-md transition-colors">Copy</button>
                    </div>
                    <textarea id="html-editor" class="code-editor bg-gray-900 text-yellow-200 p-2 rounded-md font-mono text-xs flex-grow" readonly></textarea>
                </div>

                <!-- CSS Editor -->
                <div class="bg-gray-800 rounded-xl p-4 flex flex-col shadow-lg">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-sm text-blue-400">CSS</h3>
                        <div class="flex gap-2">
                            <button class="generate-btn bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-1 px-3 rounded-md transition-colors">Generate</button>
                            <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs py-1 px-3 rounded-md transition-colors">Copy</button>
                        </div>
                    </div>
                    <textarea id="css-editor" class="code-editor bg-gray-900 text-blue-200 p-2 rounded-md font-mono text-xs flex-grow"></textarea>
                </div>

                <!-- JS Editor -->
                <div class="bg-gray-800 rounded-xl p-4 flex flex-col shadow-lg">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-sm text-pink-400">JS</h3>
                        <div class="flex gap-2">
                            <button class="generate-btn bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-1 px-3 rounded-md transition-colors">Generate</button>
                            <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs py-1 px-3 rounded-md transition-colors">Copy</button>
                        </div>
                    </div>
                    <textarea id="js-editor" class="code-editor bg-gray-900 text-pink-200 p-2 rounded-md font-mono text-xs flex-grow"></textarea>
                </div>
            </div>
        </section>
    </main>

    <!-- View Preview Section (Initially hidden) -->
    <div id="preview-main-view" class="fixed inset-0 bg-gray-900 p-4 hidden">
        <div class="flex justify-end mb-4">
            <button id="backToEditBtn" class="bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-2 px-4 rounded-lg transition-colors">Back to Editor</button>
        </div>
        <div id="preview-content" class="bg-white p-6 rounded-xl shadow-lg h-full overflow-auto">
            <!-- Rendered content will be placed here -->
        </div>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="custom-alert" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm text-center">
            <h4 class="text-xl font-semibold text-emerald-400 mb-4" id="alert-title"></h4>
            <p class="text-gray-300 mb-6" id="alert-message"></p>
            <button id="alert-ok-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-6 rounded-lg font-semibold transition-colors">OK</button>
        </div>
    </div>


    <script>
        // --- Core UI Element and State Management ---
        const designerMainView = document.getElementById('designer-main-view');
        const previewMainView = document.getElementById('preview-main-view');
        const editViewBtn = document.getElementById('editViewBtn');
        const viewPreviewBtn = document.getElementById('viewPreviewBtn');
        const backToEditBtn = document.getElementById('backToEditBtn');
        const designerCanvas = document.getElementById('designer-canvas');
        const htmlEditor = document.getElementById('html-editor');
        const cssEditor = document.getElementById('css-editor');
        const jsEditor = document.getElementById('js-editor');
        const copyBtns = document.querySelectorAll('.copy-btn');
        const generateBtns = document.querySelectorAll('.generate-btn');
        const elementsLibrary = document.getElementById('elements-library');
        const propertiesPanel = document.getElementById('properties-panel');
        const propertiesEditor = document.getElementById('properties-editor');

        // Global state to track elements on the canvas
        let pageElements = [];
        let selectedElement = null;

        // Custom alert modal
        const customAlert = document.getElementById('custom-alert');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');
        const alertOkBtn = document.getElementById('alert-ok-btn');

        function showAlert(title, message) {
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            customAlert.classList.remove('hidden');
        }
        alertOkBtn.addEventListener('click', () => {
            customAlert.classList.add('hidden');
        });

        // --- Drag and Drop Logic ---
        elementsLibrary.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('draggable')) {
                e.dataTransfer.setData('text/plain', e.target.dataset.type);
                e.dataTransfer.effectAllowed = 'copy';
            }
        });

        designerCanvas.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        });

        designerCanvas.addEventListener('drop', (e) => {
            e.preventDefault();
            const elementType = e.dataTransfer.getData('text/plain');
            if (elementType) {
                const newElement = createElement(elementType);
                designerCanvas.appendChild(newElement);
                pageElements.push({ type: elementType, content: newElement.textContent, attributes: {} });
                updateAllCode();
                // Select the new element for editing
                selectElement(newElement);
            }
        });

        // --- Element Creation and Manipulation ---
        function createElement(type) {
            let element;
            let content = '';
            let defaultClasses = '';

            switch (type) {
                case 'button':
                    element = document.createElement('button');
                    content = 'Button';
                    defaultClasses = 'bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors';
                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showAlert('Button Clicked!', 'This button will be clickable on the live page.');
                    });
                    break;
                case 'h1':
                    element = document.createElement('h1');
                    content = 'Heading';
                    defaultClasses = 'text-4xl font-bold text-gray-800';
                    break;
                case 'p':
                    element = document.createElement('p');
                    content = 'This is a paragraph of text.';
                    defaultClasses = 'text-gray-700 leading-relaxed';
                    break;
                case 'div':
                    element = document.createElement('div');
                    content = 'A new container.';
                    defaultClasses = 'bg-white p-6 rounded-lg shadow-md';
                    break;
                default:
                    return null;
            }

            element.textContent = content;
            element.classList.add(...defaultClasses.split(' '));
            element.classList.add('p-2', 'm-2', 'cursor-pointer', 'min-h-12');
            
            element.addEventListener('click', (e) => {
                e.stopPropagation();
                selectElement(e.currentTarget);
            });

            return element;
        }

        function selectElement(element) {
            if (selectedElement) {
                selectedElement.classList.remove('selected-element');
            }
            selectedElement = element;
            selectedElement.classList.add('selected-element');
            
            // Find the element in our state array
            const index = Array.from(designerCanvas.children).indexOf(element);
            if (index > -1) {
                updatePropertiesPanel(pageElements[index], element);
            }
        }

        function updatePropertiesPanel(stateElement, domElement) {
            propertiesPanel.classList.remove('hidden');
            propertiesEditor.innerHTML = '';
            
            const createInput = (label, id, type, value, onChange) => {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <label for="${id}" class="block text-sm font-medium text-gray-400">${label}</label>
                    <input id="${id}" type="${type}" value="${value}" class="mt-1 block w-full rounded-md bg-gray-600 border-transparent text-gray-100 focus:border-emerald-500 focus:ring focus:ring-emerald-500 focus:ring-opacity-50">
                `;
                const input = wrapper.querySelector('input');
                input.addEventListener('input', (e) => {
                    onChange(e.target.value);
                });
                return wrapper;
            };

            // Text content editor
            const textInput = createInput('Text Content', 'prop-text', 'text', stateElement.content, (value) => {
                stateElement.content = value;
                domElement.textContent = value;
                updateAllCode();
            });
            propertiesEditor.appendChild(textInput);

            // Add more properties here (e.g., href for links)
            if (stateElement.type === 'button') {
                const linkInput = createInput('Page Reference (href)', 'prop-link', 'text', stateElement.attributes.href || '', (value) => {
                    stateElement.attributes.href = value;
                    updateAllCode();
                });
                propertiesEditor.appendChild(linkInput);
            }
        }

        designerCanvas.addEventListener('click', (e) => {
            if (e.target === designerCanvas && selectedElement) {
                selectedElement.classList.remove('selected-element');
                selectedElement = null;
                propertiesPanel.classList.add('hidden');
            }
        });

        // --- Code Generation ---
        function generateHtml() {
            if (pageElements.length === 0) {
                return `<!-- Drag and drop elements to get started -->`;
            }

            const html = pageElements.map(el => {
                let attrs = Object.entries(el.attributes)
                    .map(([key, value]) => `${key}="${value}"`)
                    .join(' ');
                
                let classes = 'p-2 m-2'; // Base classes for all elements
                if (el.type === 'button') classes += ' bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors';
                if (el.type === 'h1') classes += ' text-4xl font-bold text-gray-800';
                if (el.type === 'p') classes += ' text-gray-700 leading-relaxed';
                if (el.type === 'div') classes += ' bg-white p-6 rounded-lg shadow-md';

                return `<${el.type} class="${classes}" ${attrs}>${el.content}</${el.type}>`;
            }).join('\n');

            return html;
        }

        function generateCss() {
            // Placeholder for modern CSS generation. This could be a more complex function
            // that adds animations or custom styles based on element properties.
            // For now, it's a fixed string with basic styles.
            return `body {
    background-color: #f3f4f6;
    font-family: 'Inter', sans-serif;
}

.modern-button {
    background-color: #34d399; /* emerald-400 */
    color: #fff;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease-in-out;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.modern-button:hover {
    background-color: #10b981; /* emerald-500 */
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

.modern-heading {
    color: #1f2937; /* gray-900 */
    font-size: 2.5rem;
    font-weight: 700;
}

.modern-paragraph {
    color: #4b5563; /* gray-600 */
    line-height: 1.6;
}
`;
        }

        function generateJs() {
            // Placeholder for modern JS generation.
            // This could be a more complex function that adds event listeners based on element properties.
            // For now, it adds a simple click handler for buttons.
            return `document.querySelectorAll('.modern-button').forEach(button => {
    button.addEventListener('click', () => {
        // Use a custom alert instead of window.alert()
        const customAlert = document.getElementById('custom-alert');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');
        const alertOkBtn = document.getElementById('alert-ok-btn');

        alertTitle.textContent = 'Button Clicked';
        alertMessage.textContent = 'This event was added by the generated JavaScript.';
        customAlert.classList.remove('hidden');

        alertOkBtn.onclick = () => {
            customAlert.classList.add('hidden');
        };
    });
});
`;
        }

        function updateAllCode() {
            htmlEditor.value = generateHtml();
            // Do not auto-generate CSS and JS unless explicitly requested
        }

        // --- View Switching Logic ---
        editViewBtn.addEventListener('click', () => {
            designerMainView.classList.remove('hidden');
            previewMainView.classList.add('hidden');
            editViewBtn.classList.replace('bg-gray-700', 'bg-emerald-600');
            editViewBtn.classList.replace('text-gray-300', 'text-white');
            viewPreviewBtn.classList.replace('bg-emerald-600', 'bg-gray-700');
            viewPreviewBtn.classList.replace('text-white', 'text-gray-300');
        });

        viewPreviewBtn.addEventListener('click', () => {
            designerMainView.classList.add('hidden');
            previewMainView.classList.remove('hidden');
            
            // Update button styles
            viewPreviewBtn.classList.replace('bg-gray-700', 'bg-emerald-600');
            viewPreviewBtn.classList.replace('text-gray-300', 'text-white');
            editViewBtn.classList.replace('bg-emerald-600', 'bg-gray-700');
            editViewBtn.classList.replace('text-white', 'text-gray-300');
            
            // Build the final page
            const previewContent = document.getElementById('preview-content');
            const finalHtml = `
                <div class="p-8">
                    ${htmlEditor.value}
                </div>
            `;
            const finalCss = cssEditor.value;
            const finalJs = jsEditor.value;

            // Create a temporary full HTML document to render
            const fullDoc = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Live Preview</title>
                    <link rel="preconnect" href="https://fonts.googleapis.com">
                    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
                    <script src="https://cdn.tailwindcss.com"></script>
                    <style>
                        body { font-family: 'Inter', sans-serif; }
                        ${finalCss}
                    </style>
                </head>
                <body>
                    <div id="page-content">
                        ${finalHtml}
                    </div>
                    <!-- Custom alert for the preview -->
                    <div id="custom-alert-preview" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
                        <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm text-center">
                            <h4 class="text-xl font-semibold text-emerald-400 mb-4" id="alert-title-preview"></h4>
                            <p class="text-gray-300 mb-6" id="alert-message-preview"></p>
                            <button id="alert-ok-btn-preview" class="bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-6 rounded-lg font-semibold transition-colors">OK</button>
                        </div>
                    </div>
                    <script>
                        ${finalJs}
                        // Handle the custom alert for the preview page
                        document.getElementById('alert-ok-btn-preview').addEventListener('click', () => {
                            document.getElementById('custom-alert-preview').classList.add('hidden');
                        });
                        function showAlert(title, message) {
                            document.getElementById('alert-title-preview').textContent = title;
                            document.getElementById('alert-message-preview').textContent = message;
                            document.getElementById('custom-alert-preview').classList.remove('hidden');
                        }
                    </script>
                </body>
                </html>
            `;
            previewContent.innerHTML = fullDoc;
        });

        backToEditBtn.addEventListener('click', () => {
            editViewBtn.click();
        });

        // --- Button Functionality ---
        copyBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const editorId = e.target.closest('.flex-col').querySelector('textarea').id;
                const editor = document.getElementById(editorId);
                editor.select();
                try {
                    document.execCommand('copy');
                    showAlert('Copied!', 'The code has been copied to your clipboard.');
                } catch (err) {
                    showAlert('Error', 'Failed to copy the code.');
                }
            });
        });

        generateBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const editorId = e.target.closest('.flex-col').querySelector('textarea').id;
                const editor = document.getElementById(editorId);
                
                if (editorId === 'css-editor') {
                    editor.value = generateCss();
                    showAlert('Generated!', 'A new modern CSS style has been generated.');
                } else if (editorId === 'js-editor') {
                    editor.value = generateJs();
                    showAlert('Generated!', 'New JavaScript effects have been generated.');
                }
            });
        });

        // Initialize with default code
        updateAllCode();
    </script>

</body>
</html>
